import { checkFloat, checkFloatArray} from './common.js';
import { timeJulianTs } from '../src/Time.js';
import { vsop87 } from '../src/Vsop87A.js';
import { marsSatellites } from '../src/Planets.js';
import { coordEqEcl } from '../src/Frames.js';
import { norm, vecMul, vecDiff } from '../src/MathUtils.js';
import {AssertionError, strict as assert} from 'assert';

describe('Planets', function() {
    describe('marsSatellites', function() {
        it('phobos', function() {            
        const horizonsData = [
            [2455197.500000000, 'A.D. 2010-Jan-01 00:00:00.0000',  1.899015692370536E+03, -8.972522104436950E+03, -1.645502655833714E+03],
            [2455228.500000000, 'A.D. 2010-Feb-01 00:00:00.0000',  8.399566307442385E+03, -1.329478158809163E+02, -4.348226830940039E+03],
            [2455256.500000000, 'A.D. 2010-Mar-01 00:00:00.0000',  2.071317132260965E+03, -8.860365994091060E+03, -1.770745053645715E+03],
            [2455287.500000000, 'A.D. 2010-Apr-01 00:00:00.0000',  8.393162898382518E+03,  2.158577499789913E+02, -4.242568631186256E+03],
            [2455317.500000000, 'A.D. 2010-May-01 00:00:00.0000',  7.683980384787781E+03,  4.202989699878438E+03, -3.510537990473260E+03],
            [2455348.500000000, 'A.D. 2010-Jun-01 00:00:00.0000', -1.064067607182285E+03,  9.365561275533757E+03,  1.307070280634464E+03],
            [2455378.500000000, 'A.D. 2010-Jul-01 00:00:00.0000', -4.550733697173233E+03,  7.844300058895347E+03,  2.880029506220029E+03],
            [2455409.500000000, 'A.D. 2010-Aug-01 00:00:00.0000', -8.190914281927398E+03, -2.758646690174400E+03,  3.767172385519475E+03],
            [2455440.500000000, 'A.D. 2010-Sep-01 00:00:00.0000', -6.044765202392389E+01, -9.261879218101472E+03, -6.787501278688724E+02],
            [2455470.500000000, 'A.D. 2010-Oct-01 00:00:00.0000',  3.571229809756472E+03, -8.231743865759046E+03, -2.309363674519815E+03],
            [2455501.500000000, 'A.D. 2010-Nov-01 00:00:00.0000',  8.184497688052955E+03,  2.078255071946711E+03, -3.763968350815578E+03],
            [2455531.500000000, 'A.D. 2010-Dec-01 00:00:00.0000',  6.668084121573681E+03,  5.778245106818844E+03, -2.809109428546200E+03],
            [2455562.500000000, 'A.D. 2011-Jan-01 00:00:00.0000', -3.197967075033971E+03,  8.592581060173099E+03,  2.025856376350848E+03],
            [2455593.500000000, 'A.D. 2011-Feb-01 00:00:00.0000', -8.538639924579307E+03, -1.119483000629958E+03,  4.019605211839928E+03],
            [2455621.500000000, 'A.D. 2011-Mar-01 00:00:00.0000', -3.441500989852986E+03,  8.422261289782089E+03,  2.073499348142606E+03],
            [2455652.500000000, 'A.D. 2011-Apr-01 00:00:00.0000', -8.443420105294384E+03, -1.513910576748167E+03,  4.013574943600671E+03],
            [2455682.500000000, 'A.D. 2011-May-01 00:00:00.0000', -7.139443272408253E+03, -5.342384410941904E+03,  3.249570047573831E+03],
            [2455713.500000000, 'A.D. 2011-Jun-01 00:00:00.0000',  2.307720193732376E+03, -9.092884396914682E+03, -1.521223071021398E+03],
            [2455743.500000000, 'A.D. 2011-Jul-01 00:00:00.0000',  5.544489997870415E+03, -7.066977170914884E+03, -3.056673310415370E+03],
            [2455774.500000000, 'A.D. 2011-Aug-01 00:00:00.0000',  7.619812666463682E+03,  4.000566387839720E+03, -3.671591608961714E+03],
            [2455805.500000000, 'A.D. 2011-Sep-01 00:00:00.0000', -1.358117591820648E+03,  9.077611328663068E+03,  1.087308806368750E+03],
            [2455835.500000000, 'A.D. 2011-Oct-01 00:00:00.0000', -4.728492558142519E+03,  7.432369388721043E+03,  2.772239642963970E+03],
            [2455866.500000000, 'A.D. 2011-Nov-01 00:00:00.0000', -7.709350737532486E+03, -3.504522971703179E+03,  3.817453912238730E+03],
            [2455896.500000000, 'A.D. 2011-Dec-01 00:00:00.0000', -5.709424703195949E+03, -6.885097501221077E+03,  2.602315070953568E+03],
            [2455927.500000000, 'A.D. 2012-Jan-01 00:00:00.0000',  4.219355516162598E+03, -8.030351172092272E+03, -2.673449014286135E+03],
            [2455958.500000000, 'A.D. 2012-Feb-01 00:00:00.0000',  8.229360864561451E+03,  2.361190200041063E+03, -4.153163673569481E+03],
            [2455987.500000000, 'A.D. 2012-Mar-01 00:00:00.0000',  8.298016822018501E+03, -1.331160839557275E+03, -4.423364620298812E+03],
            [2456018.500000000, 'A.D. 2012-Apr-01 00:00:00.0000',  3.895065446961653E+03,  8.548065768825256E+03, -1.405623963349600E+03],
            [2456048.500000000, 'A.D. 2012-May-01 00:00:00.0000',  3.773251196039164E+02,  9.458758829638264E+03,  5.283588824573180E+02],
            [2456079.500000000, 'A.D. 2012-Jun-01 00:00:00.0000', -7.866500970259587E+03,  2.714269850689699E+03,  4.252550485294129E+03],
            [2456109.500000000, 'A.D. 2012-Jul-01 00:00:00.0000', -8.258142594344601E+03, -1.376837375243241E+03,  4.085807665960257E+03],
            [2456140.500000000, 'A.D. 2012-Aug-01 00:00:00.0000', -1.144784806710959E+03, -9.159594464385225E+03, -1.854766313787795E+02],
            [2456171.500000000, 'A.D. 2012-Sep-01 00:00:00.0000',  7.713466306886163E+03, -3.181985323682629E+03, -4.103232536046700E+03],
            [2456201.500000000, 'A.D. 2012-Oct-01 00:00:00.0000',  8.357794473352653E+03,  8.788483756640203E+02, -4.043618698255765E+03],
            [2456232.500000000, 'A.D. 2012-Nov-01 00:00:00.0000',  1.875678531725879E+03,  9.278188236223785E+03, -1.727333576402448E+02],
            [2456262.500000000, 'A.D. 2012-Dec-01 00:00:00.0000', -1.839145076480425E+03,  9.170509550548570E+03,  1.594091438580549E+03],
            [2456293.500000000, 'A.D. 2013-Jan-01 00:00:00.0000', -8.542682747728206E+03,  5.287143472152509E+02,  4.136534160788952E+03],
            [2456324.500000000, 'A.D. 2013-Feb-01 00:00:00.0000', -3.143969045748464E+03, -8.806116085339692E+03,  8.961390782231319E+02],
            [2456352.500000000, 'A.D. 2013-Mar-01 00:00:00.0000', -8.589194629185016E+03,  1.085587588172855E+02,  4.096744953168076E+03],
            [2456383.500000000, 'A.D. 2013-Apr-01 00:00:00.0000', -2.840430904559834E+03, -8.974646879554837E+03,  8.181372585933018E+02],
            [2456413.500000000, 'A.D. 2013-May-01 00:00:00.0000',  8.684645426298729E+02, -9.335722510653241E+03, -9.279760688122706E+02],
            [2456444.500000000, 'A.D. 2013-Jun-01 00:00:00.0000',  8.254446552260517E+03, -1.331188981201204E+03, -4.027830967334201E+03],
            [2456474.500000000, 'A.D. 2013-Jul-01 00:00:00.0000',  8.008394314351372E+03,  2.762164370740100E+03, -3.739297085184008E+03],
            [2456505.500000000, 'A.D. 2013-Aug-01 00:00:00.0000', -3.254550482797636E+02,  9.223174821422561E+03,  5.661422810033619E+02],
            [2456536.500000000, 'A.D. 2013-Sep-01 00:00:00.0000', -8.204283451801701E+03,  1.859409359550469E+03,  4.119297208351850E+03],
            [2456566.500000000, 'A.D. 2013-Oct-01 00:00:00.0000', -8.204561041849749E+03, -2.252573128670665E+03,  3.990195227953597E+03],
            [2456597.500000000, 'A.D. 2013-Nov-01 00:00:00.0000', -6.074083702799967E+02, -9.488373993960449E+03, -9.074682434945043E+01],
            [2456627.500000000, 'A.D. 2013-Dec-01 00:00:00.0000',  3.020803328352008E+03, -8.817715352314353E+03, -1.916395766132495E+03],
            [2456658.500000000, 'A.D. 2014-Jan-01 00:00:00.0000',  8.407098559942575E+03,  7.533015332584528E+02, -4.279670459283569E+03],
            [2456689.500000000, 'A.D. 2014-Feb-01 00:00:00.0000',  1.831611515692856E+03,  9.126669862782706E+03, -4.987560193898976E+02],
            [2456717.500000000, 'A.D. 2014-Mar-01 00:00:00.0000',  8.390925719140065E+03,  1.155101369646557E+03, -4.302806602877155E+03],
            [2456748.500000000, 'A.D. 2014-Apr-01 00:00:00.0000',  1.623986681319481E+03,  9.233029120656978E+03, -3.160601909476109E+02],
            [2456778.500000000, 'A.D. 2014-May-01 00:00:00.0000', -2.003446711443476E+03,  8.990081264011125E+03,  1.608770668804472E+03],
            [2456809.500000000, 'A.D. 2014-Jun-01 00:00:00.0000', -8.193440292214873E+03, -1.579802584431739E+02,  4.270397639978368E+03],
            [2456839.500000000, 'A.D. 2014-Jul-01 00:00:00.0000', -7.439041375241381E+03, -4.139621003734872E+03,  3.576923447224452E+03],
            [2456870.500000000, 'A.D. 2014-Aug-01 00:00:00.0000',  1.504155983194777E+03, -9.053307805563152E+03, -1.467012792706628E+03],
            [2456901.500000000, 'A.D. 2014-Sep-01 00:00:00.0000',  8.363409445580568E+03, -5.250574127704995E+02, -4.339738997615273E+03],
            [2456931.500000000, 'A.D. 2014-Oct-01 00:00:00.0000',  7.938071003659698E+03,  3.525842982522862E+03, -3.754660365433057E+03],
            [2456962.500000000, 'A.D. 2014-Nov-01 00:00:00.0000', -3.515442631094280E+02,  9.460199591140668E+03,  9.629833748924552E+02],
            [2456992.500000000, 'A.D. 2014-Dec-01 00:00:00.0000', -3.912523052114146E+03,  8.254347311118154E+03,  2.638425475451339E+03],
            [2457023.500000000, 'A.D. 2015-Jan-01 00:00:00.0000', -8.294790964712016E+03, -2.035474740243201E+03,  3.921811285495643E+03],
            [2457054.500000000, 'A.D. 2015-Feb-01 00:00:00.0000', -6.777550978778771E+02, -9.229955270105927E+03, -4.124744290636759E+02],
            [2457082.500000000, 'A.D. 2015-Mar-01 00:00:00.0000', -8.305147671070950E+03, -2.380949606387064E+03,  3.833416403786336E+03],
            [2457113.500000000, 'A.D. 2015-Apr-01 00:00:00.0000', -4.560255949837885E+02, -9.286501338138180E+03, -4.696476441032582E+02],
            [2457143.500000000, 'A.D. 2015-May-01 00:00:00.0000',  3.213804801483595E+03, -8.447123211995948E+03, -2.125963434212556E+03],
            [2457174.500000000, 'A.D. 2015-Jun-01 00:00:00.0000',  8.250728929736777E+03,  1.620645751238702E+03, -3.823856710945799E+03],
            [2457204.500000000, 'A.D. 2015-Jul-01 00:00:00.0000',  6.895912670764495E+03,  5.403626700871780E+03, -2.956480775399652E+03],
            [2457235.500000000, 'A.D. 2015-Aug-01 00:00:00.0000', -2.844730588241340E+03,  8.727770036269198E+03,  1.841975489709766E+03],
            [2457266.500000000, 'A.D. 2015-Sep-01 00:00:00.0000', -8.547126051748202E+03, -7.432299962671034E+02,  4.058355836333174E+03],
            [2457296.500000000, 'A.D. 2015-Oct-01 00:00:00.0000', -7.535353440144527E+03, -4.681287424025158E+03,  3.413732472160874E+03],
            [2457327.500000000, 'A.D. 2015-Nov-01 00:00:00.0000',  1.616362703028191E+03, -9.271516897898844E+03, -1.198090342077146E+03],
            [2457357.500000000, 'A.D. 2015-Dec-01 00:00:00.0000',  5.000999214595028E+03, -7.542725293292542E+03, -2.777640041825352E+03],
            [2457388.500000000, 'A.D. 2016-Jan-01 00:00:00.0000',  7.851561170899433E+03,  3.342115986077571E+03, -3.762661340391811E+03],
            [2457419.500000000, 'A.D. 2016-Feb-01 00:00:00.0000', -7.948428037385556E+02,  9.167414194609753E+03,  7.808836509228754E+02],
            [2457448.500000000, 'A.D. 2016-Mar-01 00:00:00.0000',  2.689421529820076E+03,  8.821077022733825E+03, -9.868623209923662E+02],
            [2457479.500000000, 'A.D. 2016-Apr-01 00:00:00.0000', -6.888529601784547E+03,  4.883602083180649E+03,  3.751277133031037E+03],
            [2457509.500000000, 'A.D. 2016-May-01 00:00:00.0000', -8.151285392177067E+03,  1.003542741469034E+03,  4.260273040541112E+03],
            [2457540.500000000, 'A.D. 2016-Jun-01 00:00:00.0000', -3.190291970073024E+03, -8.734446430891679E+03,  1.200604481189748E+03],
            [2457570.500000000, 'A.D. 2016-Jul-01 00:00:00.0000',  3.837830786850328E+02, -9.369227813136413E+03, -7.342080979192110E+02],
            [2457601.500000000, 'A.D. 2016-Aug-01 00:00:00.0000',  8.161839700024890E+03, -2.108170949966513E+03, -4.400566437168986E+03],
            [2457632.500000000, 'A.D. 2016-Sep-01 00:00:00.0000',  4.463290253479814E+03,  8.168881434977919E+03, -1.786906216346766E+03],
            [2457662.500000000, 'A.D. 2016-Oct-01 00:00:00.0000',  1.036129940319188E+03,  9.398515266752811E+03,  1.319159525310833E+02],
            [2457693.500000000, 'A.D. 2016-Nov-01 00:00:00.0000', -7.607685396239295E+03,  3.357955687582745E+03,  4.196452371476505E+03],
            [2457723.500000000, 'A.D. 2016-Dec-01 00:00:00.0000', -8.258746634132318E+03, -7.022726346377497E+02,  4.192446959422095E+03],
            [2457754.500000000, 'A.D. 2017-Jan-01 00:00:00.0000', -1.704080471114568E+03, -9.075680714680046E+03,  1.261923498176393E+02],
            [2457785.500000000, 'A.D. 2017-Feb-01 00:00:00.0000',  7.463190475080384E+03, -3.826331866441421E+03, -4.083278455635721E+03],
            [2457813.500000000, 'A.D. 2017-Mar-01 00:00:00.0000', -1.558889969622021E+03, -9.105258673788563E+03,  1.691257162010379E+01],
            [2457844.500000000, 'A.D. 2017-Apr-01 00:00:00.0000',  7.547777635385005E+03, -3.592074154434132E+03, -4.025925258197525E+03],
            [2457874.500000000, 'A.D. 2017-May-01 00:00:00.0000',  8.361954039780219E+03,  4.386335661576129E+02, -4.052524052125585E+03],
            [2457905.500000000, 'A.D. 2017-Jun-01 00:00:00.0000',  2.209987749661124E+03,  9.176897149043560E+03, -3.523306956137535E+02],
            [2457935.500000000, 'A.D. 2017-Jul-01 00:00:00.0000', -1.506724024188335E+03,  9.241751759858274E+03,  1.413791725127284E+03],
            [2457966.500000000, 'A.D. 2017-Aug-01 00:00:00.0000', -8.520454830813631E+03,  9.004916438110233E+02,  4.134139483460552E+03],
            [2457997.500000000, 'A.D. 2017-Sep-01 00:00:00.0000', -3.479936261797915E+03, -8.684231651778078E+03,  1.088119578377227E+03],
            [2458027.500000000, 'A.D. 2017-Oct-01 00:00:00.0000',  1.836134280359566E+02, -9.364577076743286E+03, -6.562537058655939E+02],
            [2458058.500000000, 'A.D. 2017-Nov-01 00:00:00.0000',  8.121571708437295E+03, -1.976575634632489E+03, -3.982345310060113E+03],
            [2458088.500000000, 'A.D. 2017-Dec-01 00:00:00.0000',  8.155360669379334E+03,  2.130722345690824E+03, -3.794795945925792E+03],
            [2458119.500000000, 'A.D. 2018-Jan-01 00:00:00.0000',  2.737770845888555E+02,  9.255466619667688E+03,  3.097065450845498E+02],
            [2458150.500000000, 'A.D. 2018-Feb-01 00:00:00.0000', -8.085730518868554E+03,  2.569380524340578E+03,  4.046838243609030E+03],
            [2458178.500000000, 'A.D. 2018-Mar-01 00:00:00.0000',  7.846325098355638E+01,  9.230148707843939E+03,  3.552888682020366E+02],
            [2458209.500000000, 'A.D. 2018-Apr-01 00:00:00.0000', -8.081266725604210E+03,  2.261363610598427E+03,  4.103671513562053E+03],
            [2458239.500000000, 'A.D. 2018-May-01 00:00:00.0000', -8.242993295743063E+03, -1.848797100598732E+03,  4.057872052086198E+03],
            [2458270.500000000, 'A.D. 2018-Jun-01 00:00:00.0000', -9.398168338114657E+02, -9.450330017170185E+03,  7.383296053131016E+01],
            [2458300.500000000, 'A.D. 2018-Jul-01 00:00:00.0000',  2.698295291897053E+03, -8.943223316845695E+03, -1.781582799825233E+03],
            [2458331.500000000, 'A.D. 2018-Aug-01 00:00:00.0000',  8.426274889436587E+03,  3.723587529171996E+02, -4.332511506597997E+03],
            [2458362.500000000, 'A.D. 2018-Sep-01 00:00:00.0000',  2.214874238866631E+03,  9.055006790791287E+03, -6.802195579183895E+02],
            [2458392.500000000, 'A.D. 2018-Oct-01 00:00:00.0000', -1.415080469812661E+03,  9.124037188508197E+03,  1.254051277715575E+03],
            [2458423.500000000, 'A.D. 2018-Nov-01 00:00:00.0000', -8.158629569820724E+03,  4.833951095595035E+02,  4.296692435268667E+03],
            [2458453.500000000, 'A.D. 2018-Dec-01 00:00:00.0000', -7.645396294687084E+03, -3.560317895155971E+03,  3.760653662101549E+03],
            [2458484.500000000, 'A.D. 2019-Jan-01 00:00:00.0000',  9.256732903358940E+02, -9.207143644214158E+03, -1.138015838673349E+03],
            [2458515.500000000, 'A.D. 2019-Feb-01 00:00:00.0000',  8.285180967170883E+03, -1.278974564612578E+03, -4.393387326294057E+03],
            [2458543.500000000, 'A.D. 2019-Mar-01 00:00:00.0000',  1.102857686075803E+03, -9.117412414306862E+03, -1.285926790884952E+03],
            [2458574.500000000, 'A.D. 2019-Apr-01 00:00:00.0000',  8.312532166131094E+03, -9.204552668655460E+02, -4.319593887746507E+03],
            [2458604.500000000, 'A.D. 2019-May-01 00:00:00.0000',  8.044606145814378E+03,  3.153111508483109E+03, -3.805342840199997E+03],
            [2458635.500000000, 'A.D. 2019-Jun-01 00:00:00.0000', -1.976766336201890E+01,  9.483467487633594E+03,  8.024101379311796E+02],
            [2458665.500000000, 'A.D. 2019-Jul-01 00:00:00.0000', -3.624777651752865E+03,  8.437184439319542E+03,  2.493121692851552E+03],
            [2458696.500000000, 'A.D. 2019-Aug-01 00:00:00.0000', -8.386495106707533E+03, -1.644733688837338E+03,  3.970347788075876E+03],
            [2458727.500000000, 'A.D. 2019-Sep-01 00:00:00.0000', -1.073377885499322E+03, -9.217330521487425E+03, -2.036828587376617E+02],
            [2458757.500000000, 'A.D. 2019-Oct-01 00:00:00.0000',  2.626829999123606E+03, -8.672076064492940E+03, -1.914222069719907E+03],
            [2458788.500000000, 'A.D. 2019-Nov-01 00:00:00.0000',  8.321628697001155E+03,  9.886503834366890E+02, -3.907838245723840E+03],
            [2458818.500000000, 'A.D. 2019-Dec-01 00:00:00.0000',  7.231059002266457E+03,  4.874356008869840E+03, -3.121399183911292E+03],
            [2458849.500000000, 'A.D. 2020-Jan-01 00:00:00.0000', -2.219617083085212E+03,  8.986347645456572E+03,  1.607964023914965E+03],
            [2458880.500000000, 'A.D. 2020-Feb-01 00:00:00.0000', -8.580252955756947E+03,  3.388753889426198E+01,  4.092316549463712E+03],
            [2458909.500000000, 'A.D. 2020-Mar-01 00:00:00.0000', -7.779302680054272E+03,  3.670534938406451E+03,  3.915279397240304E+03],
            [2458940.500000000, 'A.D. 2020-Apr-01 00:00:00.0000', -5.672186257553401E+03, -7.260636924521908E+03,  2.381745639666321E+03],
            [2458970.500000000, 'A.D. 2020-May-01 00:00:00.0000', -2.408571210419850E+03, -9.171132161719250E+03,  7.556649793008655E+02],
            [2459001.500000000, 'A.D. 2020-Jun-01 00:00:00.0000',  7.061745204036807E+03, -5.019846063887458E+03, -3.678231260651606E+03],
            [2459031.500000000, 'A.D. 2020-Jul-01 00:00:00.0000',  8.326239948664965E+03, -1.136197665355127E+03, -4.173144432565588E+03],
            [2459062.500000000, 'A.D. 2020-Aug-01 00:00:00.0000',  3.234724053438444E+03,  8.578130544769441E+03, -1.264177320286961E+03],
            [2459093.500000000, 'A.D. 2020-Sep-01 00:00:00.0000', -6.588002163919734E+03,  5.428633917553883E+03,  3.567756273093698E+03],
            [2459123.500000000, 'A.D. 2020-Oct-01 00:00:00.0000', -8.091039203132140E+03,  1.655456529830624E+03,  4.211321163973471E+03],
            [2459154.500000000, 'A.D. 2020-Nov-01 00:00:00.0000', -3.775552727219394E+03, -8.477668352202360E+03,  1.541351043674370E+03],
            [2459184.500000000, 'A.D. 2020-Dec-01 00:00:00.0000', -2.503786430810000E+02, -9.425582749346486E+03, -3.573956469892669E+02],
            [2459215.500000000, 'A.D. 2021-Jan-01 00:00:00.0000',  7.976383294368925E+03, -2.868607235750205E+03, -4.322898715959420E+03]
        ];
            let avgErr = 0;
            let maxErr = 0;

            for (let indJT = 0; indJT < horizonsData.length; indJT++)
            {
                const JT = horizonsData[indJT][0];
                const rExp = [horizonsData[indJT][2], horizonsData[indJT][3], horizonsData[indJT][4]];
                const r = vecMul(coordEqEcl({ r : marsSatellites(JT).phobos, v : [0, 0, 0], JT : 0}).r, 0.001);
                const err = norm(vecDiff(r, rExp));
                //console.log(JT + " " + r + " " + rExp + " (err=" + err + ")");

                avgErr += err;
                maxErr = Math.max(maxErr, err);
            }
            avgErr /= horizonsData.length;
            console.log("Error Avg/Max " + avgErr + "/" + maxErr + " km");
            assert.equal(maxErr < 140, true);
        });

        it('deimos', function() {

const horizonsData = [
[2455197.500000000, 2.045084209599818E+04, 6.199909608789141E+03,-9.660714658273742E+03],
[2455228.500000000,-1.760509097118829E+04,-1.354038708935098E+04, 7.556915608591498E+03],
[2455256.500000000, 2.775181878444694E+03,-2.302751799427922E+04,-3.494731018379873E+03],
[2455287.500000000,-9.751232098997441E+03, 2.025365810677473E+04, 6.722258693261204E+03],
[2455317.500000000, 1.771712979811198E+04, 1.335855102745683E+04,-7.599872919185165E+03],
[2455348.500000000,-1.279856872252320E+04,-1.911226501716522E+04, 4.610649217268101E+03],
[2455378.500000000,-1.770693861242109E+04, 1.178412534409459E+04, 9.903651041192046E+03],
[2455409.500000000, 2.050808838813150E+04,-4.150630782665109E+03,-1.058891941146262E+04],
[2455440.500000000,-2.085081514145273E+04,-3.970844868156785E+03, 1.000298666227813E+04],
[2455470.500000000,-4.482397293179981E+03, 2.261804395794027E+04, 4.329389785487075E+03],
[2455501.500000000, 1.121784927542489E+04,-1.923682562598824E+04,-7.361754212299503E+03],
[2455531.500000000,-1.677297831248396E+04,-1.486028097789513E+04, 6.950750164186603E+03],
[2455562.500000000, 1.139941231103522E+04, 2.014401151527569E+04,-3.785614487235160E+03],
[2455593.500000000,-4.683647618671020E+03,-2.298589759486615E+04, 1.844817236294439E+02],
[2455621.500000000, 1.650121750450572E+04,-1.373122714348791E+04,-9.447038848010276E+03],
[2455652.500000000,-1.998431339196835E+04, 6.420323686690514E+03, 1.048245631102415E+04],
[2455682.500000000, 4.890050333269381E+03, 2.293895177700845E+04,-2.626726407995238E+02],
[2455713.500000000, 2.398240751513474E+03,-2.308989000137335E+04,-3.359717475811623E+03],
[2455743.500000000,-2.063813729047231E+04,-5.575766344762755E+03, 9.666545840685729E+03],
[2455774.500000000, 1.795775352628430E+04, 1.301032705592965E+04,-7.637580808985995E+03],
[2455805.500000000,-1.313625845086351E+04,-1.886114242441877E+04, 4.702047623128975E+03],
[2455835.500000000,-1.752135794541278E+04, 1.215526006602641E+04, 9.785591428406151E+03],
[2455866.500000000, 2.045639493977301E+04,-4.585833620248174E+03,-1.050937650751802E+04],
[2455896.500000000,-3.244117332087253E+03,-2.322387899474696E+04,-5.920385757039421E+02],
[2455927.500000000,-4.104195586365688E+03, 2.271944351506191E+04, 4.159632291381887E+03],
[2455958.500000000, 1.091165604848460E+04,-1.947569537037574E+04,-7.196820644184173E+03],
[2455987.500000000, 7.520727732172026E+03,-2.146824434821923E+04,-5.719102210893358E+03],
[2456018.500000000,-1.382397753890041E+04, 1.700100683565091E+04, 8.387192883293006E+03],
[2456048.500000000, 1.468765447587439E+04, 1.742566745869044E+04,-5.544303401445282E+03],
[2456079.500000000,-8.642925045296617E+03,-2.170116379490675E+04, 2.171699835216029E+03],
[2456109.500000000,-1.990543199075374E+04, 6.803793364458788E+03, 1.039133104862230E+04],
[2456140.500000000, 2.108071159345716E+04, 1.265173464618201E+03,-1.019554324019555E+04],
[2456171.500000000,-1.973035830051686E+04,-9.177515779560890E+03, 8.778174913620245E+03],
[2456201.500000000,-9.120019524926169E+03, 2.063997196466214E+04, 6.418190082295664E+03],
[2456232.500000000, 1.506049061177735E+04,-1.565709742156919E+04,-8.840310203446639E+03],
[2456262.500000000,-1.344984775809266E+04,-1.861740786544805E+04, 4.794944850971381E+03],
[2456293.500000000, 7.053555631272145E+03, 2.232935011107753E+04,-1.316071975010304E+03],
[2456324.500000000, 1.671845464069683E+02,-2.334478269751917E+04,-2.303361591776238E+03],
[2456352.500000000, 1.913067525728339E+04,-8.994502035181391E+03,-1.015973223022831E+04],
[2456383.500000000,-2.104089521881444E+04, 1.063300571411894E+03, 1.032603115917336E+04],
[2456413.500000000, 4.466457577046514E+01, 2.335114331873778E+04, 2.217719402950662E+03],
[2456444.500000000, 7.173643966356251E+03,-2.162871496918527E+04,-5.558491633535875E+03],
[2456474.500000000,-1.918837966553850E+04,-1.065349660813352E+04, 8.292224205649130E+03],
[2456505.500000000, 1.499519210966198E+04, 1.713197641083842E+04,-5.633094088505837E+03],
[2456536.500000000,-9.020498928329414E+03,-2.153427545504643E+04, 2.312700700228527E+03],
[2456566.500000000,-1.981416316848736E+04, 7.222785823292944E+03, 1.028245163565595E+04],
[2456597.500000000, 2.112932915374245E+04, 8.186711287397934E+02,-1.014009715120271E+04],
[2456627.500000000, 1.651328857666138E+03,-2.320454389841244E+04,-3.012207500949258E+03],
[2456658.500000000,-8.795048223558537E+03, 2.083464397649751E+04, 6.233689982731757E+03],
[2456689.500000000, 1.483222877482185E+04,-1.596585274744890E+04,-8.677197820687881E+03],
[2456717.500000000, 1.998169072798316E+04, 8.550052966018060E+03,-8.810227634470801E+03],
[2456748.500000000,-1.641076700620523E+04,-1.548922108149309E+04, 6.419744802518315E+03],
[2456778.500000000,-1.470298500577915E+04, 1.611857343961220E+04, 8.620344722790540E+03],
[2456809.500000000, 1.901446571835594E+04,-9.363724899892350E+03,-1.004469190825701E+04],
[2456839.500000000,-7.629437322138939E+03,-2.213243314127358E+04, 1.550834944906943E+03],
[2456870.500000000, 4.047477961541990E+02, 2.336416766411544E+04, 2.038277620727908E+03],
[2456901.500000000, 6.846490888660197E+03,-2.178392765639386E+04,-5.365996123570147E+03],
[2456931.500000000,-1.937855235691257E+04,-1.028254651252690E+04, 8.317547004270775E+03],
[2456962.500000000, 1.528183517393467E+04, 1.684624364956883E+04,-5.718418833992033E+03],
[2456992.500000000, 1.588579808499501E+04,-1.472062540750420E+04,-9.004168569037683E+03],
[2457023.500000000,-1.973238004937344E+04, 7.610628984118668E+03, 1.015872431700911E+04],
[2457054.500000000, 2.117369494541914E+04, 4.009146537984034E+02,-1.007525568085642E+04],
[2457082.500000000, 9.550006991139015E+03, 2.127091538073970E+04,-2.521045188784150E+03],
[2457113.500000000,-2.515912318519528E+03,-2.330340616800722E+04,-1.033492654818318E+03],
[2457143.500000000,-2.118188303956580E+04,-1.723512368503079E+02, 1.008969973499845E+04],
[2457174.500000000, 2.014469559571066E+04, 8.143526313500008E+03,-8.827157826419734E+03],
[2457204.500000000, 8.243052434385660E+03,-2.114323250531389E+04,-5.945158386718376E+03],
[2457235.500000000,-1.444660138686375E+04, 1.644018408920307E+04, 8.442422731277635E+03],
[2457266.500000000, 1.888191347771565E+04,-9.769885325905107E+03,-9.907420150056643E+03],
[2457296.500000000,-8.005220754706100E+03,-2.198660895229874E+04, 1.714932464414742E+03],
[2457327.500000000, 7.863602939568431E+02, 2.337016083833228E+04, 1.844497418627292E+03],
[2457357.500000000, 2.118708217988252E+04, 2.049788164986586E+03,-9.849466422456630E+03],
[2457388.500000000,-1.957034722474675E+04,-9.903535993193018E+03, 8.329921974481515E+03],
[2457419.500000000, 1.556608942268146E+04, 1.655490134462564E+04,-5.796679760449538E+03],
[2457448.500000000, 1.789970488447947E+04, 1.333195069573880E+04,-7.202696222044739E+03],
[2457479.500000000,-1.292000967387867E+04,-1.910546771342188E+04, 4.297006744214762E+03],
[2457509.500000000,-1.788001545244662E+04, 1.179117915214689E+04, 9.568916499280025E+03],
[2457540.500000000, 2.071167038310925E+04,-4.184276851168634E+03,-1.018122507781354E+04],
[2457570.500000000,-2.869095942429186E+03,-2.326991932338504E+04,-8.411821052685627E+02],
[2457601.500000000,-4.511626745573144E+03, 2.262115080729129E+04, 4.257444793788810E+03],
[2457632.500000000, 1.132711991806859E+04,-1.925740176689623E+04,-7.146106052941269E+03],
[2457662.500000000,-1.694228056792745E+04,-1.483636026755396E+04, 6.580173547338522E+03],
[2457693.500000000, 1.152037943308616E+04, 2.012130976816077E+04,-3.524593843079802E+03],
[2457723.500000000, 1.875619928353261E+04,-1.015013989588827E+04,-9.762756208895176E+03],
[2457754.500000000,-2.105085242389352E+04, 2.316698987287153E+03, 1.009793334127211E+04],
[2457785.500000000, 2.078503170941214E+04, 5.764461431027131E+03,-9.208245971606078E+03],
[2457813.500000000, 4.935909769185211E+03, 2.292580112413724E+04,-1.564557760083935E+02],
[2457844.500000000, 2.428974879210420E+03,-2.309927894103470E+04,-3.309009477759318E+03],
[2457874.500000000,-2.083918486818809E+04,-5.545370547074974E+03, 9.244169417504756E+03],
[2457905.500000000, 1.813842393036063E+04, 1.296462066849669E+04,-7.280121761019744E+03],
[2457935.500000000, 1.258409679515499E+04,-1.828648701393180E+04,-7.589325098064382E+03],
[2457966.500000000,-1.770460195260852E+04, 1.218005475745816E+04, 9.403898171798864E+03],
[2457997.500000000, 2.066964118707852E+04,-4.622866670995284E+03,-1.007564602883007E+04],
[2458027.500000000,-3.244688150656877E+03,-2.322669197642968E+04,-6.402900817044501E+02],
[2458058.500000000,-4.162974661218814E+03, 2.272627558010284E+04, 4.044384445976917E+03],
[2458088.500000000, 2.044305564626305E+04, 7.358161828924425E+03,-8.835149144836756E+03],
[2458119.500000000,-1.719018165243336E+04,-1.451570323047063E+04, 6.654349109126791E+03],
[2458150.500000000, 1.184089566454768E+04, 1.990777560355428E+04,-3.665990969772172E+03],
[2458178.500000000,-1.088574380089962E+04, 1.960826153762537E+04, 6.870325180654376E+03],
[2458209.500000000, 1.647772238382732E+04,-1.409281052703832E+04,-8.954964268643284E+03],
[2458239.500000000,-1.203344628033968E+04,-1.978694371179340E+04, 3.771645244366652E+03],
[2458270.500000000, 5.287953704421911E+03, 2.284492283313782E+04,-3.630740607367643E+02],
[2458300.500000000, 2.099777770062167E+04,-3.000530580763047E+03,-1.001069751096637E+04],
[2458331.500000000,-2.094613023122406E+04,-5.137668494635494E+03, 9.233554602072047E+03],
[2458362.500000000, 1.835729967099698E+04, 1.261699885025137E+04,-7.343961794175831E+03],
[2458392.500000000, 1.232606924944219E+04,-1.854593069932341E+04,-7.383697336556211E+03],
[2458423.500000000,-1.753921821070349E+04, 1.253835166944117E+04, 9.241179551127258E+03],
[2458453.500000000, 1.058528662389552E+04, 2.071217035175049E+04,-2.998774961635028E+03],
[2458484.500000000,-3.614430757311011E+03,-2.317686620666348E+04,-4.418205585165360E+02],
[2458515.500000000,-3.806097125775341E+03, 2.282480319843506E+04, 3.828690033501425E+03],
[2458543.500000000,-2.057437326853027E+04, 5.269239438915914E+03, 9.964712631121682E+03],
[2458574.500000000, 2.124150546258188E+04, 2.823930705884143E+03,-9.534059929718624E+03],
[2458604.500000000, 3.575127099597434E+03,-2.288915667936805E+04,-3.703591128473677E+03],
[2458635.500000000,-1.057518165904122E+04, 1.985239418776573E+04, 6.643300388430974E+03],
[2458665.500000000, 1.756099495324257E+04, 1.396678824704918E+04,-6.822893161823706E+03],
[2458696.500000000,-1.235967677193830E+04,-1.955353274126707E+04, 3.931789219662479E+03],
[2458727.500000000, 5.658509997435318E+03, 2.275232140871341E+04,-5.711539839782963E+02],
[2458757.500000000, 2.097747310929521E+04,-3.426143445439046E+03,-9.920366473033670E+03],
[2458788.500000000,-2.104577402801814E+04,-4.726685340592493E+03, 9.221858666351382E+03],
[2458818.500000000,-5.309531492861396E+03, 2.241201754715700E+04, 4.417417776044957E+03],
[2458849.500000000, 1.206389454212046E+04,-1.879568541567084E+04,-7.184768895796359E+03],
[2458880.500000000,-1.736772933917480E+04, 1.288670905990848E+04, 9.084771696394611E+03],
[2458909.500000000,-1.487394282074980E+04, 1.616292661767976E+04, 8.226164715324840E+03],
[2458940.500000000, 1.920946117671464E+04,-9.433722616610790E+03,-9.610271110657824E+03],
[2458970.500000000,-7.648794965785255E+03,-2.212724506389487E+04, 1.564463468328176E+03],
[2459001.500000000, 3.646062149601717E+02, 2.337460048647802E+04, 1.865404225133092E+03],
[2459031.500000000, 2.130715651949436E+04, 2.403586914539382E+03,-9.507202405147318E+03],
[2459062.500000000,-1.952710190529014E+04,-1.024406014090407E+04, 8.006668521691079E+03],
[2459093.500000000, 1.538938429960198E+04, 1.680740355138395E+04,-5.547452653308071E+03],
[2459123.500000000, 1.606836165296789E+04,-1.477994592321897E+04,-8.589972708972809E+03],
[2459154.500000000,-1.992114959195546E+04, 7.670929735343938E+03, 9.723905780634066E+03],
[2459184.500000000, 6.018914137734819E+03, 2.265382582283413E+04,-7.800813282729996E+02],
[2459215.500000000, 1.362744789602808E+03,-2.327425806454298E+04,-2.622628207237220E+03]];
                     
            let avgErr = 0;
            let maxErr = 0;
            for (let indJT = 0; indJT < horizonsData.length; indJT++)
            {
                const JT = horizonsData[indJT][0];
                const rExp = [horizonsData[indJT][1], horizonsData[indJT][2], horizonsData[indJT][3]];
                const r = vecMul(coordEqEcl({ r : marsSatellites(JT).deimos, v : [0, 0, 0], JT : 0}).r, 0.001);
                const err = norm(vecDiff(r, rExp));

                avgErr += err;
                maxErr = Math.max(maxErr, err);
                //console.log(JT + " " + r + " " + rExp + " (err=" + err + ")");
            }
            avgErr /= horizonsData.length;
            console.log("Error Avg/Max " + avgErr + "/" + maxErr + " km");
            assert.equal(maxErr < 270, true);
        });
    });
});
